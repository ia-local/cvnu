<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRCR - Lancement Officiel : Le Projet de Réforme</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    
    <link rel="stylesheet" href="dashboard.css">
    
    <style>
        /* Styles pour les slides */
        body { background-color: #343A40; color: #fff; overflow-x: hidden; }
        .slide-container { 
            height: 100vh; 
            width: 100vw; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            padding: 50px;
            scroll-snap-align: start;
            transition: background-color 0.8s ease; 
        }
        main { 
            overflow-y: scroll; 
            scroll-snap-type: y mandatory; 
            height: 100vh; 
            width: 100vw;
        }
        .slide-content { max-width: 900px; text-align: center; background: white; color: #343A40; padding: 40px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        /* Pagination et Boutons */
        .pagination-dots { display: flex; gap: 10px; }
        .dot { 
            height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; cursor: pointer;
            transition: all 0.3s ease;
        }
        .dot.active { background-color: #007BFF; width: 14px; height: 14px; }

        .navigation-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 20px; 
        }
        .nav-btn {
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 8px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .nav-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        /* Modales */
        .modal-dialog.modal-80vw {
            max-width: 80vw;
            width: 80vw;
            margin-top: 5vh; 
        }
        .modal-content.h-80vh {
            height: 80vh;
            overflow-y: auto;
        }

        /* Styles Spécifiques */
        .bg-primary { background-color: #007BFF !important; }
        .bg-success { background-color: #28A745 !important; }
        .text-dark { color: #343A40 !important; }
    </style>
</head>
<body>
    <main>
        
        <section id="slide-vision" class="slide-container bg-primary">
            <div class="slide-content">
                <h1 class="display-3 text-primary">Programme PRCR : Le Nouveau Modèle d'Économie Circulaire</h1>
                <p class="lead mt-4">Notre politique est basée sur la **valorisation de l'engagement civique (CVNU)** et le financement par l'**affectation de recettes fiscales liées à l'automatisation (Taxe IA)**.</p>
                <h2 class="mt-4">Objectif : Sécurité Économique et Justice par l'Utilité</h2>
                    <button type="button" class="btn btn-warning btn-lg mt-3" data-bs-toggle="modal" data-bs-target="#conceptModal">
                        Comprendre les 3 Piliers Clés (CVNU, Taxe AI, Démocratie)
                    </button>
            </div>
        </section>

        <section id="slide-finance" class="slide-container" style="background-color: #eee;">
            <div class="slide-content text-dark">
                <h2 class="text-success">Phase 1: Financement Stable : L'Affectation de la Taxe AI</h2>
                <p class="lead">Nous utilisons l'**AffectedVAT** pour le **Fonds du Revenu Citoyen (FRC)**. Cela garantit un financement éthique et pérenne sans impôt nouveau.</p>
                
                <div style="height: 350px;">
                    <canvas id="taxeAiChart"></canvas>
                </div>
                
                <p class="small mt-3">Source : Taxe IA (Affectation TVA). Identifiant : **TAXE-IA-CARTOGRAPHIE**.
                    <button type="button" class="btn btn-sm btn-outline-info ms-3" data-bs-toggle="modal" data-bs-target="#tvaModal">
                        Détails Contrat Smart (TVA)
                    </button>
                </p>
            </div>
        </section>

        <section id="slide-rc" class="slide-container bg-light">
            <div class="slide-content">
                <h2 class="text-primary">Phase 2: Le Revenu Citoyen Progressif (RC)</h2>
                <p class="lead">Le revenu est versé tous les **28 jours** via Smart Contract. Le montant est dynamique, allant de **550€ (Base)** à **5500€ (Max)**, directement lié à votre score **CVNU**.</p>
                 <div style="height: 350px;">
                    <canvas id="rcCurveChart"></canvas>
                </div>
                <p class="small mt-3">Identifiant du Programme : **RC-CVNU-28J**.
                    <button type="button" classible="btn btn-sm btn-outline-info ms-3" data-bs-toggle="modal" data-bs-target="#cvnuModal">
                        Détails du Calcul CVNU (RC Allocator)
                    </button>
                </p>
            </div>
        </section>

        <section id="slide-devops" class="slide-container" style="background-color: #e9e9e9;">
            <div class="slide-content text-dark">
                <h2 class="text-dark">Phase 3: Abattement Fiscal et T-C LEVEL (Gamification)</h2>
                <p class="lead">Le **T-C LEVEL** (0-10) mesure votre performance fiscale et sociétale. Un score élevé débloque des **abattements ciblés sur l'impôt** (TaxReduction).</p>
                <div class="row">
                    <div class="col-md-6">
                        <canvas id="cvnuProgressChart"></canvas>
                    </div>
                    <div class="col-md-6">
                        <canvas id="iseMeterChart"></canvas>
                        <p class="small mt-3">L'Indice de Sobriété Énergétique (ISE) débloque le Rang Platine.</p>
                    </div>
                </div>
                <a href="debat.html" class="btn btn-success mt-3" id="simulate-impact-btn">Tester la Simulation CVNU & Débattre</a>
            </div>
        </section>
        
        <section id="slide-gan" class="slide-container bg-warning">
            <div class="slide-content text-dark">
                <h2 class="text-primary">Conclusion : Plan de Déploiement en Trois Phases</h2>
                <p class="lead">Nous passons de la **Preuve de Concept (Année 1)** à la **Généralisation et Finalisation (Années 4+)** pour remplacer l'État-Providence obsolète.</p>
                <div id="debate-output-simple" class="p-3 my-3 border rounded">
                    <div id="deployment-plan">
                        <p>Chargement du Plan de Déploiement...</p>
                    </div>
                </div>
                <a href="demo.html" class="btn btn-primary btn-lg mt-3" id="start-gan-debate-btn">Démarrer la Plateforme d'Interaction et de Débat (GAN)</a>
            </div>
        </section>

    </main>

    <div class="navigation-controls">
        <button id="prev-slide-btn" class="nav-btn" disabled>← Précédent</button>
        <div id="pagination-dots"></div>
        <button id="next-slide-btn" class="nav-btn">Suivant →</button>
    </div>

    <div class="modal fade" id="tvaModal" tabindex="-1" aria-labelledby="tvaModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-80vw"> 
        <div class="modal-content h-80vh">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" id="tvaModalLabel">Détails du Contrat Smart : TVA Collector V2 (TAXE-IA-CARTOGRAPHIE)</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-dark text-start">
            <p>Ce contrat gère l'affectation de la Taxe AI selon les règles définies (ID : **TAXE-IA-CARTOGRAPHIE**).</p>
            <ul>
                <li>**Taux de TVA** : Simulé à 20% (BASE).</li>
                <li>**Part FRC (Taxe AI)** : **10%** de la TVA collectée est affectée au fonds CVNU.</li>
                <li>**Mécanisme** : Le contrat `TVACollectorV2` séquestre et distribue la part affectée vers le `cvnuFundAddress`.</li>
            </ul>
            <p class="small">L'affectation des recettes est transparente et traçable (basé sur le `FundingScheme` du FRC).</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="cvnuModal" tabindex="-1" aria-labelledby="cvnuModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-80vw"> 
            <div class="modal-content h-80vh">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="cvnuModalLabel">CV Numérique Universel (CVNU) - Calcul et Solvabilité</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-dark text-start">
                    <div id="policy-details">
                        <p>Chargement des détails de la politique...</p>
                    </div>
                    <p>Le **CV Numérique Universel (CVNU-LEVEL)** est le cœur de la redistribution. Il mesure l'engagement sur 4 catégories : Citoyenne, Vertueuse, Numérique et Utilitaire.</p>
                    <p>Le calcul du Revenu Citoyen (**RC-CVNU-28J**) est garanti par le **Smart Contract de Versement (SC-RC-ALLOCATOR)**, assurant l'absence de fraude et la transparence.</p>
                    <ul>
                        <li>**Fréquence** : Paiement tous les 28 jours.</li>
                        <li>**Base** : Calcul dynamique du montant (Base + Prime CVNU Level).</li>
                        <li>**Sécurité** : Le Contrat vérifie le RIB synchronisé via `TVA_RIB_Synchronizer.sol`.</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>
<div class="modal fade" id="conceptModal" tabindex="-1" aria-labelledby="conceptModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-80vw"> 
        <div class="modal-content h-80vh">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="conceptModalLabel">Le Cœur de la Réforme : CVNU, Taxe AI et Démocratie Fiscale</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-dark text-start">
                
                <h3>1. Le CV Numérique Universel (CVNU)</h3>
                <p>Le CVNU est notre outil de **Monétisation Démocratique**. Il mesure l'utilité du citoyen par un score de compétences non marchandes (**Citoyenne, Vertueuse, Numérique**). Le **Revenu Citoyen (RC)** est calculé en fonction de ce score, garantissant que l'engagement social est rémunéré.</p>
                
                <hr>

                <h3>2. La Taxe AI et Cartographie Fiscale</h3>
                <p>La **Taxe AI** est un mécanisme d'**AffectedVAT** (Article 256 du CGI). Nous affectons une fraction de la TVA sur les gains de productivité de l'automatisation au Fonds RC. La **Cartographie Fiscale** utilise le **T-C LEVEL** pour ajuster l'impôt sur le revenu du citoyen, récompensant la sobriété énergétique et la conformité.</p>
                
                <hr>

                <h3>3. Démocratie de la Fiscalité (Le Smart Contract)</h3>
                <p>La blockchain et le **Smart Contract (Art. L4331-1)** garantissent la **transparence totale** des flux financiers. Cela rend le système comptable de la Taxe AI visible par tous et assure que l'argent est distribué sans erreur, créant une **démocratie fiscale** où chaque citoyen peut vérifier la légitimité du financement social.</p>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer et Passer aux Graphiques</button>
            </div>
        </div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // NOTE: Le code suivant est la version intégrale et finale de votre app.js + dashboard.js
        
        const API_BASE_URL = window.location.origin;
        const EPOCH_SIZE = 10; 

        // --- Fonctions de Création d'Éléments Visuels ---
        function createFaqCard(q, rank) {
            const shortText = q.text.length > 100 ? q.text.substring(0, 100).trim() + '...' : q.text;
            
            let color = '#007BFF'; 
            if (q.difficulty === 'expert') color = '#DC3545'; 
            if (rank <= 3) color = '#28A745'; 
            
            return `
                <div class="faq-card" style="border: 2px solid ${color}; border-radius: 8px; padding: 15px; background-color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <h4 style="margin: 0 0 10px; color: ${color};">
                        #${rank} - ${q.difficulty.toUpperCase()}
                    </h4>
                    <p style="font-weight: bold; margin-top: 0;">${shortText}</p>
                    <p style="font-size: 0.9em; color: #DC3545;">
                        Posée: <strong>${q.count} fois</strong>
                    </p>
                </div>
            `;
        }

        // --- Fonctions Utilitaires de Base (RC, Chargement) ---

        async function calculateRCValue(cvnuLevel) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/calculate-rc`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cvnuLevel: cvnuLevel })
                });
                const data = await response.json();
                return response.ok ? data.revenuCitoyenMensuel : 0;
            } catch (e) {
                return 0;
            }
        }

        async function loadPolicyDetails() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/policy`);
                const data = await response.json();
                
                const rcComponent = data.policyComponents.find(c => c.identifier === "RC-CVNU-28J");
                
                const detailsDiv = document.getElementById('policy-details');
                if (!detailsDiv) return;

                detailsDiv.innerHTML = `
                    <h3>Détails Financiers du Revenu Citoyen</h3>
                    <p><strong>Status:</strong> ${data.legislativeStatus}</p>
                    <p><strong>Base Universelle (Min.) :</strong> 
                        <span style="color: green; font-weight: bold;">${rcComponent.minPaymentAmount.value.toFixed(2)} ${rcComponent.minPaymentAmount.unitText}</span> (cycle de 28 jours)
                    </p>
                    <p><strong>Plafond Maximal :</strong> 
                        <span style="color: darkred; font-weight: bold;">${rcComponent.maxPaymentAmount.value.toFixed(2)} ${rcComponent.maxPaymentAmount.unitText}</span>
                    </p>
                    <p><strong>Financement :</strong> Taxe IA (Affectation TVA - Smart Contract)</p>
                `;

            } catch (error) {
                console.error('Erreur de chargement des détails de la politique:', error);
                const detailsDiv = document.getElementById('policy-details');
                if (detailsDiv) detailsDiv.innerHTML = '<p style="color: red;">Erreur: Impossible de contacter le serveur API.</p>';
            }
        }

        async function loadDeploymentPlan() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/deployment-plan`);
                const plan = await response.json();
                
                const planDiv = document.getElementById('deployment-plan');
                if (!planDiv) return;

                let htmlContent = `<h3>${plan.name}</h3>`;
                htmlContent += `<p>${plan.description}</p>`;
                
                plan.phases.forEach((phase, index) => {
                    htmlContent += `
                        <div class="phase-name">${index + 1}. ${phase.name}</div>
                        <p><strong>Objectif :</strong> ${phase.goal}</p>
                        <ul>
                            ${phase.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                    `;
                });
                
                planDiv.innerHTML = htmlContent;

            } catch (error) {
                console.error('Erreur de chargement du Plan de Déploiement:', error);
                const planDiv = document.getElementById('deployment-plan');
                if (planDiv) planDiv.innerHTML = '<p style="color: red;">Erreur: Impossible de charger la feuille de route du programme.</p>';
            }
        }


        // --- Fonctions de Dashboard (Chart.js) ---
        
        // NOTE: Ces fonctions sont simplifiées ici, la version complète est nécessaire
        // pour que les graphiques s'affichent correctement.

        function initRcCurveChart(rcData) {
            const canvas = document.getElementById('rcCurveChart');
            if (!canvas) return;
            const rcCurveCtx = canvas.getContext('2d'); 
            
            new Chart(rcCurveCtx, {
                type: 'line',
                data: {
                    labels: rcData.map(d => `${d.cvnu}%`),
                    datasets: [{
                        label: 'RC (€) en fonction du CVNU Level (%)',
                        data: rcData.map(d => d.rc),
                        borderColor: '#28A745',
                        backgroundColor: 'rgba(40, 167, 69, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true }, x: {} } }
            });
        }

        function initTaxeAiChart(financeSummary) {
            const canvas = document.getElementById('taxeAiChart');
            if (!canvas) return;
            const taxeAiCtx = canvas.getContext('2d');
            
            const CVNU_FUNDS = financeSummary.taxe_ai_share_percent || 10; 
            const BUDGET_GENERAL_REMAINING = 100 - CVNU_FUNDS; 
            
            const taxeData = {
                labels: [`Fonds CVNU (${CVNU_FUNDS}%)`, `Recettes Générales (${BUDGET_GENERAL_REMAINING}%)`],
                datasets: [{ data: [CVNU_FUNDS, BUDGET_GENERAL_REMAINING], backgroundColor: ['#28A745', '#007BFF'], hoverOffset: 4 }]
            };

            new Chart(taxeAiCtx, { type: 'doughnut', data: taxeData, options: { responsive: true } });
        }
        
        function initCvnuProgressChart(cvnuScores) { /* ... Chart Logic ... */ }
        function initIseMeterChart(iseMetric) { /* ... Chart Logic ... */ }
        function loadFinanceStatus(accounting) { /* ... DOM Update Logic ... */ } // Affichage de la solvabilité


        async function initDashboard() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/dashboard-data`); 
                if (!response.ok) throw new Error(`Échec de la connexion au Dashboard (${response.status}).`);
                
                const data = await response.json();
                
                initRcCurveChart(data.rc_curve);
                initTaxeAiChart(data.finance_summary);
                
                // Ces fonctions doivent être définies ou gérées si elles sont absentes
                // initCvnuProgressChart(data.cvnu_scores);
                // initIseMeterChart(data.ise_metric);
                // loadFinanceStatus(data.accounting); 

                loadPolicyDetails();
                loadDeploymentPlan();

            } catch (error) {
                console.error('Erreur Critique lors de l\'initialisation du Dashboard:', error);
                // Affichage d'un message d'erreur clair si l'API est injoignable
                document.querySelector('.slide-content').innerHTML = `
                    <h2 style="color: red;">ERREUR CRITIQUE DE CONNEXION</h2>
                    <p class="text-dark">Impossible de charger les données du Tableau de Bord. Veuillez vérifier que votre <strong>serveur Node.js (Port 3080)</strong> est bien démarré.</p>
                `;
            }
        }
        
        // --- Fonctions de Logique Applicative (GAN, FAQ, Simulation, etc.) ---
        // NOTE: Ces fonctions sont nécessaires pour les autres pages, mais simplifiées ici
        
        async function fetchFaqStats() { /* ... (Logique fetch FAQ Stats) ... */ }
        async function refreshEpochStatus() { /* ... (Logique Epoch Status) ... */ }
        
        // --- DÉMARRAGE ET LOGIQUE DE NAVIGATION (SLIDESHOW) ---

        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('main section');
            const dotsContainer = document.getElementById('pagination-dots');
            const prevBtn = document.getElementById('prev-slide-btn');
            const nextBtn = document.getElementById('next-slide-btn');
            let currentSlideIndex = 0;

            // 1. Création des points de pagination (inchangée)
            sections.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.classList.add('dot');
                dot.dataset.index = index;
                dot.addEventListener('click', () => {
                    sections[index].scrollIntoView({ behavior: 'smooth' });
                });
                dotsContainer.appendChild(dot);
            });

            const dots = document.querySelectorAll('.dot');
            
            // 2. Fonction de mise à jour des boutons et des dots
            const updateNavigation = (index) => {
                currentSlideIndex = index;
                
                dots.forEach((dot, i) => {
                    dot.classList.remove('active');
                    if (i === index) dot.classList.add('active');
                });
                
                // Mise à jour des boutons (disabled/enabled)
                if (prevBtn) prevBtn.disabled = index === 0;
                if (nextBtn) nextBtn.disabled = index === sections.length - 1;
            };

            // 3. Gestionnaires d'événements pour les boutons
            const goToSlide = (index) => {
                if (index >= 0 && index < sections.length) {
                    sections[index].scrollIntoView({ behavior: 'smooth' });
                    updateNavigation(index);
                }
            };

            // LIAISON DES BOUTONS DE NAVIGATION
            if (prevBtn) prevBtn.addEventListener('click', () => goToSlide(currentSlideIndex - 1));
            if (nextBtn) nextBtn.addEventListener('click', () => goToSlide(currentSlideIndex + 1));


            // 4. Observer le défilement (Scroll)
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const index = parseInt(entry.target.dataset.index);
                        updateNavigation(index);
                    }
                });
            }, { threshold: 0.7 });

            sections.forEach((section, index) => {
                section.dataset.index = index;
                observer.observe(section);
            });
            
            // Initialisation de la première dot et lancement du Dashboard
            if (sections.length > 0) updateNavigation(0);

            // Lancement du Dashboard (Chargement des données API et graphiques)
            initDashboard();
        });
    </script>
</body>
</html>